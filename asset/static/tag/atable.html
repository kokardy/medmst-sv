<atable>

<style>
.drug_name{
    font-weight:bold;
    font-size:larger;
}
.package{
    font-weight:bold;
}

/* 不採用 */
tr.status0{
    background-color:#CCCCCC;
}
/* 院内 */
tr.status1{
    background-color:#FFAAAA;
}
/* 院外 */
tr.status2{
    background-color:#AAFFAA;
}
/* 院内院外採用 */
tr.status3{
    background-color:white;
}

a,a:visited{
    color:blue;
}

em{
    font-size:Larger;
    font-weight:bold;

}


</style>

<div class="info">
下の検索ボックスに薬品名・会社名・YJコードなどを入力して検索してください。
</div>

<span>検索:</span>

<!-- 検索BOX  -->
<input
    id="query_string"
    name="query_string"
    type="text"
    ref="query"
    class="query_input"
    >
</input>
<button onClick="{change}">検索</button>

<table>
    <thead>
        <th each="{field, index in fields}" class="{field}">
            { field }
        </th>
    </thead>

    <tbody>
            <tr class="status{status_flag}" data-is="drug" each="{drugs}"></tr>
    </tbody>
</table>

    <script>


this.on("mount", function(){
  document.getElementById("query_string").focus()
})


this.drugs = [ ]

this.fields = [
    "コード",
    "名称",
    "コメント",
    "薬価",
    "リンク",
]

change(e){
    console.log("change")
    var tag = this
    var queryStr = this.refs.query.value
    var url = "/json/available/"
    url += "?query=" + queryStr
    url = encodeURI(url)
    fetch(url)
    .then(function(data){
        return data.json()
    })
    .then(function(json){
        console.log(url)
        console.debug(json)
        tag.drugs = json
        tag.update()
    })
    .then(undefined, function onRejected(error){
        console.log("rejected:" + error)
    })



}


    </script>
</atable>


<drug>
    <td>
            薬価コード:{this["薬価基準収載医薬品コード"]} <br/>
            YJコード:{this["個別医薬品コード"]} <br/>
            薬品コード:{this["drug_code"]} <br/>
            カスタムYJ:{this['custom_yj']} <br/>
    </td>
    <td>
            <em>{this["採用状態"]}</em> 
            成分名:{this["成分名"]}
            <div class="drug_name">
                <a href="/redirect/pmda/yj/{ this['個別医薬品コード'] }" target="_blank">
                    {this["販売名"]}
                </a>
            </div>
            <span class="package">
            {this["包装形態"]}
            {this["包装単位数"]}
            {this["包装単位単位"]}
            :
            {this["規格単位"]}
            </span>
            製造:{this["製造会社"]} 販売:{this["販売会社"]}
            <!-- 告示名称:{this["告示名称"]} -->
    </td>
    <td class="center">
            {this["yj_comment"]} {this["hot_comment"]}
    </td>
    <td class="center">
            {this["新_金額"]} 円/ 
            {this["単位_漢字名称"]}
    </td>
    <td class="outerlink">
        <div if={ this['個別医薬品コード'] }>
        <a
        target="_blank"
        href="//10.26.61.131/jiho/latest/CYJ/{this['個別医薬品コード']}.pdf">
                JIHO(薬効)
        </a>
        <a
        target="_blank"
        href="//10.26.61.131/jiho/latest/IYJ/{this['個別医薬品コード']}.pdf">
                JIHO(成分)
        </a>
        <!-- GS1:{ GS1toJAN(this['JAN']) } -->
        <!-- JAN:{ this['JAN'] } -->
        <button onclick="gs1search({ GS1toJAN(this['JAN']) });">GS1での検索結果へ</button>
        </div>
    </td>


save_status(e){
  console.log("a this:" + Object.keys(this))
  console.log("opts:" + this.opts)
  console.log("opts:" + Object.keys(this.opts))
}

</drug>
