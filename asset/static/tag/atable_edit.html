<atable>

<span>検索:</span>

<!-- 検索BOX  -->
<input
    type="text"
    ref="query"
    class="query_input"
/>
<button onClick="{change}">検索</button>

<table>
    <thead>
        <th each="{field, index in Object.keys(drugs[0])}" class="{field}">
            { field }
        </th>
        <th class="change_status_YJ">
                採用状態YJ
        </th>
        <th class="change_status_HOT11">
                採用状態HOT11
        </th>
    </thead>

    <tbody>
    <tr each="{drug in drugs}">
        <td each="{value, field in drug}" class="{field}">
            { value }
        </td>
        <td class="change_status_YJ">
            <input name="status_change" value="3"
            type="radio" 
            onChange="{change_statusYJ.bind(this, drug["薬価基準収載医薬品コード"], 3)}">
            採用</input>     <br/>
            <input name="status_change" value="1"
            type="radio"
            onChange="{change_statusYJ.bind(this, drug["薬価基準収載医薬品コード"], 1)}">
            院内採用</input> <br/>
            <input name="status_change" value="2"
            type="radio"
            onChange="{change_statusYJ.bind(this, drug["薬価基準収載医薬品コード"], 2)}">
            院外採用</input> <br/>
            <input name="status_change" value="0"
            type="radio"
            onChange="{change_statusYJ.bind(this, drug["薬価基準収載医薬品コード"], 0)}">
            不採用</input>   <br/>
        </td>
        <td class="change_status_HOT11">
            <input name="status_change" value="3"
            type="radio"
            onChange="{change_statusHOT.bind(this, drug["HOT11"], 3)}">
            採用</input>     <br/>
            <input name="status_change" value="1"
            type="radio"
            onChange="{change_statusHOT.bind(this, drug["HOT11"], 1)}">
            院内採用</input> <br/>
            <input name="status_change" value="2"
            type="radio"
            onChange="{change_statusHOT.bind(this, drug["HOT11"], 2)}">
            院外採用</input> <br/>
            <input name="status_change" value="0"
            type="radio"
            onChange="{change_statusHOT.bind(this, drug["HOT11"], 0)}">
            不採用</input>   <br/>
        </td>
    </tr>
    </tbody>
</table>

    <script>
this.drugs = [
{   "使い方": "検索ボックスに薬品名、厚労省コード、会社名などを入れて検索ボタンをクリックしてください",
    status: "active"},
]

change_statusYJ(yj, new_stat, e){
    console.log("yj:"+ yj +
    " change_status:"+ new_stat)
}

change_statusHOT(hot, new_stat, e){
    console.log("hot:"+ hot + 
    " change_status:"+ new_stat)
}


change(e){
    console.log("change")
    var tag = this
    var queryStr = this.refs.query.value
    var url = "/json/available/"
    url += "?query=" + queryStr
    url = encodeURI(url)
    fetch(url)
    .then(function(data){
        return data.json()
    })
    .then(function(json){
        console.log(url)
        console.log(json)
        tag.drugs = json
        tag.fields = Object.keys(tag.drugs[0])
    })
    .then(undefined, function onRejected(error){
        console.log("rejected:" + error);
    });

}


    </script>
</atable>

