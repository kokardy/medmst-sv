<atable>

<div class="info">
下の検索ボックスに薬品名・会社名・YJコードなどを入力して検索してください。
</div>

<span>検索:</span>

<!-- 検索BOX  -->
<input
    type="text"
    ref="query"
    class="query_input"
/>
<button onClick="{change}">検索</button>

<table>
    <thead>
        <th each="{field, index in fields}" class="{field}">
            { field }
        </th>
    </thead>

    <tbody>
            <tr data-is="drug" each="{drugs}"></tr>
    </tbody>
</table>

    <script>
this.drugs = [ ]

this.fields = [
    "医薬品コード",
    "名称",
    "規格単位",
    "包装",
    "会社",
    "薬価",
    "採用状態",
    "採用状態YJ",
    "採用状態HOT",
    "保存",
]


change_statusYJ(yj, new_stat, e){
    console.log("yj:"+ yj +
    " change_status:"+ new_stat)
    var url = "/edit/yj/"
    var data = {
        yjcode: yj,
        status: new_stat,
    }
    fetch(url, {
      method: "PUT",
      cache: "no-cache",
      credentials: "same-origin",
      headers: {
              "Content-Type": "application/json; charset=utf-8",
      },
      body: JSON.stringify(data),
    })
    .then(function(json){
       var result = json["result"]
       console.log("PUT:" + data  + " result:" + result)
    })

}

change_statusHOT(hot, new_stat, e){
    console.log("hot:"+ hot + 
    " change_status:"+ new_stat)
}


change(e){
    console.log("change")
    var tag = this
    var queryStr = this.refs.query.value
    var url = "/json/available/"
    url += "?query=" + queryStr
    url = encodeURI(url)
    fetch(url)
    .then(function(data){
        return data.json()
    })
    .then(function(json){
        console.log(url)
        tag.drugs = json
        tag.update()
    })
    .then(undefined, function onRejected(error){
        console.log("rejected:" + error);
    });

}


    </script>
</atable>


<drug>
    <td>
            厚労省コード:{this["薬価基準収載医薬品コード"]} <br/>
            YJコード:{this["個別医薬品コード"]} <br/>
            薬品コード:
            <input
                ref="drug_code" 
                name="drug_code_{this['HOT11']}" 
                value="{this['drug_code']}">
            </input>
            カスタムYJ:
            <input
                ref="custom_yj" 
                name="custom_yj_{this['HOT11']}" 
                value="{this['custom_yj']}">
            </input>


    </td>
    <td>
            販売名:{this["販売名"]} <br/>
            告示名称:{this["告示名称"]}
    </td>
    <td>
            {this["規格単位"]}
    </td>
    <td>
            {this["包装形態"]}
            {this["包装単位数"]}
            {this["包装単位単位"]}
    </td>
    <td>
            製造:{this["製造会社"]} <br/>
            販売:{this["販売会社"]}
    </td>
    <td>
            {this["新_金額"]} / 
            {this["単位_漢字名称"]}
    </td>
    <td>
            {this["採用状態"]}
    </td>
    <td>
        <input name="yj_status_{this['HOT11']}"
                                    value="3"
                                    checked='{this["yj_status"]==3}'
                                    type="radio" >
        採用</input>     <br/>
        <input name="yj_status_{this['HOT11']}"
                                    value="1"
                                    checked='{this["yj_status"]==1}'
                                    type="radio">
        院内採用</input> <br/>
        <input name="yj_status_{this['HOT11']}" 
                                    value="2"
                                    checked='{this["yj_status"]==2}'
                                    type="radio">
        院外採用</input> <br/>
        <input name="yj_status_{this['HOT11']}" 
                                    value="0"
                                    checked='{this["yj_status"]==0}'
                                    type="radio">
        不採用</input>   <br/>
        コメント:
        <input name="yj_comment_{this['HOT11']}"
               value='{this["yj_comment"]}'>
        </input>
    </td>
    <td>
        <input name="hot_status_{this['HOT11']}"
                                    value="3"
                                    checked='{this["hot_status"]==3}'
                                    type="radio" >
        採用</input>     <br/>
        <input name="hot_status_{this['HOT11']}"
                                    value="1"
                                    checked='{this["hot_status"]==1}'
                                    type="radio">
        院内採用</input> <br/>
        <input name="hot_status_{this['HOT11']}"
                                    value="2"
                                    checked='{this["hot_status"]==2}'
                                    type="radio">
        院外採用</input> <br/>
        <input name="hot_status_{this['HOT11']}"
                                    value="0"
                                    checked='{this["hot_status"]==0}'
                                    type="radio">
        不採用</input>   <br/>
        コメント:
        <input name="hot_comment_{this['HOT11']}" 
               value='{this["hot_comment"]}'>
        </input>
    </td>
    <td>
            <button onClick="{save_status}">保存</button>
        <div id="save_{this['HOT9']}"></div>
    </td>


save_status(e){
  console.log("a this:" + Object.keys(this))
  console.log("opts:" + this.opts)
  console.log("opts:" + Object.keys(this.opts))
}

</drug>
